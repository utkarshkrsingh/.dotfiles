"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{57020:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ie});var i=a(30758),r=a(1978),s=a(40904),o=a(63166),n=a(64721),l=a(16249),c=a(9498),d=a(75294);var u=a(17631),h=a(60545),g=a(83341);let I=null;const S=(0,a(68841).h)(),p="sp://auth/v1/token_web_auth";function T(e){const t=(0,u.S)((e=>e.setStatus)),[a,r]=(0,i.useState)(""),s=(0,i.useCallback)((async()=>{if(e){t(h.Z.AUTHENTICATION_STARTED);const a=await E(e).catch((e=>{throw(I||(I=g.logger),I).error("error: could not fetch IDT token!"),t(h.Z.AUTHENTICATION_FAILED),e}));a&&(t(h.Z.AUTHENTICATION_SUCCEEDED),r(a.accessToken))}}),[e,t]);return(0,i.useEffect)((()=>{e&&s()}),[e,s]),a}async function E(e){if(!e)return;const t=new URL(p);return t.searchParams.append("audience",e),await S.get(t.toString())}var N=a(15758),f=a(72509);let b=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function y(e){switch(e){case 0:case"NONE":return b.NONE;case 1:case"STT":return b.STT;case 2:case"IDT":return b.IDT;default:return b.UNRECOGNIZED}}let m=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function w(e){switch(e){case 0:case"INVALID":return m.INVALID;case 1:case"VALID":return m.VALID;case 2:case"ACTIVE":return m.ACTIVE;default:return m.UNRECOGNIZED}}let C=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const O={fromJSON:e=>({id:k(e.id)?globalThis.String(e.id):"0",campaignId:k(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:k(e.lookupToken)?globalThis.String(e.lookupToken):"",url:k(e.url)?globalThis.String(e.url):"",authType:k(e.authType)?y(e.authType):0,clientId:k(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!k(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:k(e.status)?w(e.status):0,restricted:!!k(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:k(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:k(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map((e=>function(e){switch(e){case 0:case"ALCOHOL":return C.ALCOHOL;case 1:case"ENERGY_DRINKS":return C.ENERGY_DRINKS;default:return C.UNRECOGNIZED}}(e))):[],enableLegacySharing:!!k(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!k(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!k(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!k(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map((e=>globalThis.String(e))):[],restoreOnKilled:!!k(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!k(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.campaignId&&(t.campaignId=e.campaignId),""!==e.lookupToken&&(t.lookupToken=e.lookupToken),""!==e.url&&(t.url=e.url),0!==e.authType&&(t.authType=function(e){switch(e){case b.NONE:return"NONE";case b.STT:return"STT";case b.IDT:return"IDT";case b.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(t.clientId=e.clientId),!1!==e.hasAudio&&(t.hasAudio=e.hasAudio),0!==e.status&&(t.status=function(e){switch(e){case m.INVALID:return"INVALID";case m.VALID:return"VALID";case m.ACTIVE:return"ACTIVE";case m.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(t.restricted=e.restricted),""!==e.gcpProjectId&&(t.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(t.defaultLocale=e.defaultLocale),e.restrictions?.length&&(t.restrictions=e.restrictions.map((e=>function(e){switch(e){case C.ALCOHOL:return"ALCOHOL";case C.ENERGY_DRINKS:return"ENERGY_DRINKS";case C.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)))),!1!==e.enableLegacySharing&&(t.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(t.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(t.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(t.enableCheckout=e.enableCheckout),e.allowedCountries?.length&&(t.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(t.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(t.enableMediaDevices=e.enableMediaDevices),t},create:e=>O.fromPartial(e??{}),fromPartial(e){const t={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return t.id=e.id??"0",t.campaignId=e.campaignId??"0",t.lookupToken=e.lookupToken??"",t.url=e.url??"",t.authType=e.authType??0,t.clientId=e.clientId??void 0,t.hasAudio=e.hasAudio??!1,t.status=e.status??0,t.restricted=e.restricted??!1,t.gcpProjectId=e.gcpProjectId??"",t.defaultLocale=e.defaultLocale??"",t.restrictions=e.restrictions?.map((e=>e))||[],t.enableLegacySharing=e.enableLegacySharing??!1,t.hidePlayer=e.hidePlayer??!1,t.legacyBackBehavior=e.legacyBackBehavior??!1,t.enableCheckout=e.enableCheckout??!1,t.allowedCountries=e.allowedCountries?.map((e=>e))||[],t.restoreOnKilled=e.restoreOnKilled??!1,t.enableMediaDevices=e.enableMediaDevices??!1,t}};const v={fromJSON:e=>({site:k(e.site)?O.fromJSON(e.site):void 0}),toJSON(e){const t={};return void 0!==e.site&&(t.site=O.toJSON(e.site)),t},create:e=>v.fromPartial(e??{}),fromPartial(e){const t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?O.fromPartial(e.site):void 0,t}};function k(e){return null!=e}var D=a(96022);const L={fromJSON:e=>({id:R(e.id)?globalThis.String(e.id):"0",siteId:R(e.siteId)?globalThis.String(e.siteId):"0",title:R(e.title)?globalThis.String(e.title):"",description:R(e.description)?globalThis.String(e.description):"",previewImageUrl:R(e.previewImageUrl)?globalThis.String(e.previewImageUrl):"",locale:R(e.locale)?globalThis.String(e.locale):"",height:R(e.height)?globalThis.Number(e.height):void 0,width:R(e.width)?globalThis.Number(e.width):void 0}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.siteId&&(t.siteId=e.siteId),""!==e.title&&(t.title=e.title),""!==e.description&&(t.description=e.description),""!==e.previewImageUrl&&(t.previewImageUrl=e.previewImageUrl),""!==e.locale&&(t.locale=e.locale),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.width&&(t.width=Math.round(e.width)),t},create:e=>L.fromPartial(e??{}),fromPartial(e){const t={id:"0",siteId:"0",title:"",description:"",previewImageUrl:"",locale:"",height:void 0,width:void 0};return t.id=e.id??"0",t.siteId=e.siteId??"0",t.title=e.title??"",t.description=e.description??"",t.previewImageUrl=e.previewImageUrl??"",t.locale=e.locale??"",t.height=e.height??void 0,t.width=e.width??void 0,t}};const A={fromJSON:e=>({metadata:R(e.metadata)?L.fromJSON(e.metadata):void 0}),toJSON(e){const t={};return void 0!==e.metadata&&(t.metadata=L.toJSON(e.metadata)),t},create:e=>A.fromPartial(e??{}),fromPartial(e){const t={metadata:void 0};return t.metadata=void 0!==e.metadata&&null!==e.metadata?L.fromPartial(e.metadata):void 0,t}};function R(e){return null!=e}var P=a(5050);const U=18e5,B=6e5,M={all:["vtec"],sites:()=>[...M.all,"site"],site:e=>[...M.sites(),e],siteMetadata:(e,t)=>[...M.site(e),t]},_=e=>{const{onStart:t,onError:a,onSuccess:i}=(()=>{const e=(0,u.S)((e=>e.setStatus));return{onStart:()=>e(h.Z.RESOLVING_SITE_STARTED),onSuccess:()=>e(h.Z.RESOLVING_SITE_SUCCEEDED),onError:t=>{e(h.Z.RESOLVING_SITE_FAILED)}}})(),{data:r,error:s,isPending:o,isSuccess:l}=(0,N.I)({queryKey:M.site(e),queryFn:async()=>(t(),await(async(e,t)=>await e.build().withHost(`${D.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((e=>({...e,body:v.fromJSON(e.body)}))))(P.n.getInstance(),e)),select:e=>e.body.site,staleTime:B,gcTime:U});if(s)throw a(s),s;const c=n.Ru.getLocaleForTranslation(),{data:d,error:g,isPending:I,isSuccess:S}=(0,N.I)({queryKey:M.siteMetadata(e,c),queryFn:r?.defaultLocale?async()=>{const t=await(async(e,t,a)=>await e.build().withHost(`${D.sp}`).withMethod("GET").withoutMarket().withPath(`/sites/${t}/metadata/${a}`).withEndpointIdentifier("/sites/{lookupId}/metadata/{localeCode}").withJsonContentType().send().then((e=>({...e,body:A.fromJSON(e.body)}))))(P.n.getInstance(),e,c);return i(),t}:f.hT,select:e=>e.body.metadata,enabled:!!r?.defaultLocale,staleTime:B,gcTime:U});if(g)throw a(g),g;return{site:r,isSiteSuccess:l,siteMetadata:d,isSiteMetadataSuccess:S,isPending:o||I}},G="NWSmcn03uY8Fosh_mYCi",Z="N9ngMcd9oSDEd8zK5jBj",V="kYOJhuJ996EIMXFJD3By";var J=a(86070);const K=()=>{const{lookupToken:e=""}=(0,r.g)(),{site:t,siteMetadata:a}=_(e),i=T(t?.clientId),s=(()=>{const e=(0,d.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();let o="";return t?.url&&s&&(o=function(e,t,a){const i=new URL(e);i.searchParams.append("utm_app_version",t),a&&(i.hash=`#id_token=${a}`);return i.toString()}(t?.url,s,i)),(0,J.jsx)("div",{className:G,children:(0,J.jsx)("iframe",{title:a?.title,name:"stage-view-frame",id:Z,src:o,sandbox:"allow-scripts allow-same-origin"})})};var j=a(97500),q=a.n(j),H=a(65234);var x=a(86502),Y=a(13979),F=a(2799);const $=Y.$S.PANEL_CLOSE_CLICK;var z=a(75627),W=a(72744);var X=a(95440);var Q=a(43671);function ee(e,t){const a=(0,i.useRef)(),s=(0,i.useMemo)((()=>new AbortController),[]),{signal:o}=s,l=function(){const e=(0,r.Zp)(),t=(0,X.d4)((e=>e.ui.history.canGoBack));return(0,i.useCallback)((()=>{e(t?-1:"/")}),[e,t])}(),c=(()=>{const e=(0,u.S)((e=>e.setStatus)),{enqueueSnackbar:t}=(0,W.d)();return{onSuccess:()=>{t(n.Ru.get("feedback.link-copied")),e(h.Z.SHARE_EVENT)},onError:a=>{t(n.Ru.get("error.generic")),e(h.Z.ERROR)}}})(),d=(0,i.useCallback)((i=>{if(!e||!e.includes(i.origin))return;const r=JSON.parse(i.data);"didRequestInitialize"===r.type?(a.current={source:i.source,options:{targetOrigin:i.origin}},function(e){const{source:t,options:a}=e,i=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(i,a)}(a.current)):"didRequestIDToken"===r.type?(a.current={source:i.source,options:{targetOrigin:i.origin}},async function(e,t){const{source:a,options:i}=e,r=await E(t);if(!r)return;if(!r.accessToken)return;const s=JSON.stringify({type:"didReceiveIDToken",token:r.accessToken});a.postMessage(s,i)}(a.current,t)):"didRequestClose"===r.type?l():"didRequestShare"===r.type&&async function(e,t,a){const{source:i,options:r}=e;if("didRequestShare"!==t.type)return;let s;const o=(0,z.o_h)(t.url);o&&(s=o.toURL());await(0,Q.l)(s).catch((e=>{throw a.onError(e),e})),a.onSuccess();const n={type:"didDismissShare",requestId:t.requestId};i.postMessage(JSON.stringify(n),r)}(a.current,r,c)}),[e,t,c,l]);(0,i.useEffect)((()=>(e&&window.addEventListener("message",(e=>d(e)),{signal:o}),()=>{s.abort()})),[e,s,d,o])}var te=a(32751);var ae=a(19412);const ie=e=>{(()=>{const{scrollNodeChildRef:e}=(0,i.useContext)(H.bi);(0,i.useEffect)((()=>{const t=e?.current,a=e?.current?.className;return t&&(t.className=q()(a,V)),()=>{t&&(t.className=q()(a))}}),[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,x.AI)(F.Z.NowPlayingView);e&&t($)})(),function(){const e=(0,te.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause()}();const{lookupToken:t=""}=(0,r.g)(),{isPending:a,site:d}=_(t),[g]=(0,i.useState)((0,s.A)());((e,t)=>{const a=(0,u.S)((e=>e.setStatus)),r=(0,u.S)((e=>e.setSession)),s=(0,u.S)((e=>e.resetSession)),o=(0,i.useCallback)(a,[a]),n=(0,i.useCallback)(r,[r]),l=(0,i.useCallback)(s,[s]);(0,i.useEffect)((()=>(n({siteId:e,sessionId:t,startTime:Date.now()}),o(h.Z.PRESENTED),()=>{o(h.Z.DISMISSED),l()})),[l,n,o,t,e])})(t,g),ee(d?.url,d?.clientId);return(0,o.NC)(ae.n2U)?(0,J.jsx)(l.s,{children:a?(0,J.jsx)(c.LoadingPage,{hasError:!1,errorMessage:n.Ru.get("error.generic")}):(0,J.jsx)(K,{})}):(0,J.jsx)(c.LoadingPage,{hasError:!0,errorMessage:n.Ru.get("error.not_found.title.page")})}},75294:(e,t,a)=>{a.d(t,{k:()=>s});var i=a(30758),r=a(18633);function s(){const e=(0,r.t)(),[t,a]=(0,i.useState)(null);return(0,i.useEffect)((()=>{let t=!0;return e.getVersionInfo().then((e=>{t&&a(e)})),()=>{t=!1}}),[e,a]),t}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map