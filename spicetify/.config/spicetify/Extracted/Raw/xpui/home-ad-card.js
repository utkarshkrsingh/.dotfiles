"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[599,8554],{57594:(e,t,s)=>{s.d(t,{U:()=>n});var a=s(64721),i=s(49740),o=s(44979),r=s(86070);const n=({menu:e,onClick:t,"aria-label":s})=>(0,r.jsx)(o.b,{menu:e,children:(0,r.jsx)(i.e,{size:i.M.xs,label:a.Ru.get("more"),ariaLabel:s,onClick:t})})},8554:(e,t,s)=>{s.r(t),s.d(t,{CtaButton:()=>d,default:()=>c});var a=s(30758),i=s(97589),o=s(57615),r=s(61214),n=s(55285),l=s(86070);const d=({"aria-label":e,text:t,onClick:s,clickUrl:d,backgroundColor:c,className:u})=>{const m=(0,a.useMemo)((()=>{if(!c)return;const e=(0,i.mA)(c);return{...e,text:{...e.text,base:o.LLE}}}),[c]);return(0,l.jsx)(n.N,{"aria-label":e||t,className:u,"data-testid":"ad-cta-button",to:d,onClick:e=>{e.stopPropagation(),s()},children:(0,l.jsx)(r.$,{UNSAFE_colorSet:m,colorSet:"invertedLight",size:"small",children:t})})},c=d},80220:(e,t,s)=>{s.r(t),s.d(t,{HomeAdCard:()=>ze,default:()=>Be});var a=s(30758),i=s(86560);const o={opacity:0,height:"0px"};function r({dismiss:e}){const[t,s]=(0,a.useState)(null),[r,n]=(0,a.useState)(0);(0,a.useEffect)((()=>{if(t){n(t.offsetHeight);const e=new ResizeObserver((()=>n(t.offsetHeight)));return e.observe(t),()=>e.disconnect()}return n(0),()=>{}}),[t]);const l=r?(e=>({opacity:1,height:`calc(${e}px + ${(0,i.po)("base")})`}))(r):o,d=(0,a.useRef)(null);return{setGridElement:s,shownHeight:r,transitionableStyles:l,containerRef:d,collapseHeightThenDismiss(){if(!d.current||!r)return void e();d.current.animate([l,o],{fill:"forwards",easing:"ease",duration:420}).onfinish=e}}}var n=s(97500),l=s.n(n),d=s(36688),c=s(47359),u=s(64721),m=s(57594),h=s(8554),y=s(56989),v=s(43602),b=s(91814),f=s(99903),x=s(12433),g=s(95309),p=s(86070);const k=(0,a.memo)((function({onDismissAdClick:e}){return(0,p.jsx)(g.pZ,{value:"home-ad",children:(0,p.jsx)(f.W,{children:(0,p.jsx)(g.pZ,{value:"dismiss",children:(0,p.jsx)(x.D,{role:"menuitem",leadingIcon:(0,p.jsx)(b.P,{size:"small"}),"aria-label":u.Ru.get("ad-formats.context-menu.not-interested"),onClick:e,children:u.Ru.get("ad-formats.context-menu.not-interested")})})})})}));var j=s(84576),A=s(14903);const P="kvXKrQ08Ar7oAsMVJNOg",C="dBm03FPk9rHjecHq1Qnn",E=({className:e,homeAd:t,dismiss:s})=>{const a=(0,j.vh)(),i=(0,v.L)(),o=l()(P,e),{extractedHomeAdColor:[r]}=(0,y.bT)(),n=(0,A.A)((()=>{s(),i.log("collapsed",t),a.send((0,c.F)({ad_id:t.adId,advertiser:t.metadata.advertiser,creative_id:t.metadata.creative_id,event:"dislike_HPTO",format:(0,d.gh)(t.format),line_item_id:t.metadata.line_item_id}))})),b=(0,A.A)((()=>{i.log("clicked",t)})),f=t.metadata.buttonText||u.Ru.get("ad-formats.learnMore");return(0,p.jsxs)("div",{className:o,children:[t.clickthroughUrl&&(0,p.jsx)(h.CtaButton,{className:C,"aria-label":`${f}, link`,text:f,clickUrl:t.clickthroughUrl,onClick:b,backgroundColor:r?.colorDark}),(0,p.jsx)(m.U,{"aria-label":"More options, button",menu:(0,p.jsx)(k,{onDismissAdClick:n})})]})};var N=s(6128),w=s(55285);const _="lscHwwYXzt0CrEPAQgu3",S=({className:e,description:t,label:s,homeAd:a})=>{const i=l()(_,e),{clickthroughUrl:o,metadata:{tagline:r}}=a,n=(0,v.L)(),d=(0,A.A)((()=>{o&&n.log("clicked",a)}));return(0,p.jsxs)("div",{className:i,children:[s&&(0,p.jsx)(N.E,{variant:"bodyMedium",children:s}),r&&(0,p.jsx)(w.N,{to:o,onClick:d,"aria-label":`${r}, link`,children:(0,p.jsx)(N.E,{variant:"titleMedium",children:r})}),t&&(0,p.jsx)(N.E,{variant:"bodySmall",children:t})]})};var R=s(96930),U=s(91825),T=s(65583);const M="rLoSLtWsmOdhdiNz3r17",V=({className:e,homeAd:t})=>{const{metadata:{advertiser:s,logoImage:a},clickthroughUrl:i}=t,o=(0,v.L)(),r=(0,A.A)((()=>{i&&o.log("clicked",t)}));return(0,p.jsx)(w.N,{"aria-label":`${s}, Advertisement, link`,className:l()(e,M),to:i,onClick:r,children:(0,p.jsx)(R.v,{id:"advertiser-info",isInteractive:!1,media:a,padding:"0",subtitle:(0,p.jsx)(U.j,{children:u.Ru.get("ad-formats.advertisement")}),title:(0,p.jsx)(T.d,{children:s})})})};var L=s(73762),O=s(17909);const F="acMBKZuLlROUat0sL2a_",H=({className:e,icon:t,...s})=>(0,p.jsx)("div",{className:l()(F,e),...s,children:t});function z(e){const{imageUrlToExtractHomeAdColorFrom:[,t]}=(0,y.bT)();(0,a.useEffect)((()=>t(e)),[e,t]),(0,a.useEffect)((()=>()=>t(void 0)),[t])}var B=s(75627);function I(e){for(const{imageFileId:t,url:s}of e.display){if(t){const e=(0,B.CCi)(t).toURI();if(e)return e}if(s)return s}}var D=s(70490);const W="lNTmTLY8RhoIIjrz4eyI",$=({className:e,displayAssetUrl:t,homeAd:s})=>{const i=(0,v.L)(),o=(0,A.A)((()=>{i.log("viewed",s)})),r=(0,A.A)((()=>{i.log("clicked",s)}));return(0,a.useEffect)((()=>o()),[o]),(0,p.jsx)(w.N,{to:s.clickthroughUrl,className:e,onClick:r,children:(0,p.jsx)(D._,{className:W,testid:"home-ad-display-asset",loading:"lazy",src:t,children:(0,p.jsx)(H,{icon:(0,p.jsx)(L.b,{})})})})},q=({className:e,homeAd:t})=>{const s=(0,a.useMemo)((()=>I(t)),[t]);return z(s),s?(0,p.jsx)($,{className:e,homeAd:t,displayAssetUrl:s}):(0,p.jsx)(H,{className:e,icon:(0,p.jsx)(O.c,{size:"large"}),"data-testid":"home-ad-display-asset-fallback"})};var X=s(41213);const G="JS7sJfGVY9xjxR3eWJVq",Y=(0,a.memo)((({homeVideoAd:e})=>{const t=(0,a.useMemo)((()=>I(e)),[e]);return t?(0,p.jsx)($,{className:G,displayAssetUrl:t,homeAd:e}):(0,p.jsx)(H,{className:G,icon:(0,p.jsx)(L.b,{})})}));var Z=s(39818);var J=s(85418);var Q=s(84014),K=s(754);const ee=a.useState;var te=s(90152),se=s(17045);class ae{hasLogged=!1;isPlaying=!1;logTimeout=null;position=0;visibilityState="";get trackingEnabled(){return this.focusState.hasFocus()&&this.isPlaying&&this.isAdVisible}constructor(e,t,s,a=new se.j,i){this.focusState=e,this.ad=t,this.logger=s,this.visibilityObserver=a,this.targetElement=i}onPlaybackCreated(e){this.visibilityObserver.observe(this.targetElement,this.onVisibilityChanged),this.focusState.addFocusListener(this),this.position=0,this.reset()}onStarted({position:e}){this.position=e,this.isPlaying=!0,this.startCountdown()}onResumed({position:e}){this.position=e,this.isPlaying=!0,this.startCountdown()}onBuffering({position:e}){this.position=e,this.reset()}onPaused({position:e}){this.isPlaying=!1,this.position=e,this.reset()}onPlaybackEnded({position:e}){this.visibilityObserver.disconnect(),this.focusState.removeFocusListener(this),this.position=e,this.reset()}onFocusChanged(e){this.reset(),e&&this.startCountdown()}startCountdown(){this.hasLogged||(this.clearExistingTimeout(),this.logTimeout=setTimeout((()=>{this.logEvent()}),2e3))}reset(){this.clearExistingTimeout()}clearExistingTimeout(){this.logTimeout&&(clearTimeout(this.logTimeout),this.logTimeout=null)}logEvent(){if(!this.hasLogged&&this.trackingEnabled)try{this.logger.log("viewability",this.ad,{position:Math.floor(1e3*this.position)}),this.hasLogged=!0}catch(e){}}onVisibilityChanged=e=>{const t=this.visibilityState;this.visibilityState=e,"visible_0"!==e&&"visible_unknown"!==e||this.reset();"visible_0"===t&&("visible_50"===e||"visible_100"===e)&&this.startCountdown()};get isAdVisible(){return"visible_50"===this.visibilityState||"visible_100"===this.visibilityState}}var ie=s(83290);var oe=s(61214),re=s(51064),ne=s(28078),le=s(42223),de=s(76263),ce=s(32751);const ue="oedSb2mjjyBaeN9twoSA",me="FLXTIzOmNsF6knFRXaZS",he="GJ9evYudn2W7Lr5yMA5i",ye="EjfHeXS7GNvs18SAYXe2",ve=({betamaxPlayer:e,muted:t,paused:s,isContextPlayerVideoPlaying:a,isContextPlayerPlaybackPaused:i})=>{const o=(0,ce.z)();return(0,p.jsxs)("div",{className:ue,children:[(0,p.jsx)("div",{className:he,children:t?(0,p.jsx)(oe.$,{"aria-label":"Unmute, button",colorSet:"overMedia",iconOnly:re.X,onClick:()=>{e.setAudioDisabled(!1),!o.getState()?.item||a||i||o.pause()},size:"small"}):(0,p.jsx)(oe.$,{"aria-label":"Mute, button",colorSet:"overMedia",iconOnly:ne.z,onClick:()=>e.setAudioDisabled(!0),size:"small"})}),(0,p.jsx)("div",{className:ye,children:s?(0,p.jsx)(oe.$,{"aria-label":"Play, button",colorSet:"overMedia",iconOnly:le.A,onClick:()=>{e.resume(),o.getState()?.item&&a&&!i&&o.pause()},size:"medium"}):(0,p.jsx)(oe.$,{"aria-label":"Pause, button",className:me,colorSet:"overMedia",iconOnly:de._,onClick:()=>e.pause(),size:"medium"})})]})};var be=s(97849),fe=s(92857),xe=s(20019);function ge(e,t,s,a){return new be.A({mediaExtensions:[new fe.h(e)],factories:[s]}).createBetamaxPlayer({videoElementConfig:{controls:!1,loop:!0},containerElement:t,networkConfiguration:{getAuthorizationHeader:async()=>{const{accessToken:e,tokenType:t}=await xe.l.get("sp://oauth/v2/token");return`${t} ${e}`}}})}async function pe(e,{mediaUrl:t,playback_id:s,playWhenReady:a}){return await e.play({mediaUrl:t,isRoyaltyMedia:!1,metadata:{playback_id:s}},{playWhenReady:a})}var ke=s(43086);const je="WJllnHWGxXydlZGNRZiO",Ae="r0vbWTxR_IGYTZyvgFMh",Pe=({assetUrl:e,homeVideoAd:t,videoContainerElement:s,createVideoPlayer:i=ge,playVideoPlayer:o=pe})=>{const{betamaxPlayer:r,setBetamaxPlayer:n}=function(){const[e,t]=ee((()=>Promise.resolve(void 0)));return{betamaxPlayer:e,setBetamaxPlayer:t}}(),l=(0,v.L)(),{isContextPlayerVideoPlaying:d,isContextPlayerPlaybackPaused:c}={isContextPlayerVideoPlaying:(0,Q.o)(K.A3),isContextPlayerPlaybackPaused:(0,Q.o)((e=>e?.isPaused))},u=!d||c,{muted:m,paused:h,loading:y,errored:b=!0,observerFactory:f,viewabilityObserverFactory:x}=function(e,t,s,i){const[o,r]=(0,a.useState)(!0),[n,l]=(0,a.useState)(!i),[d,c]=(0,a.useState)(!0),[u,m]=(0,a.useState)(!1),h=(0,a.useCallback)((()=>new ae(new ie.A,e,t,new se.j,s)),[e,t,s]);return{muted:o,paused:n,loading:d,errored:u,observerFactory:(0,a.useCallback)((()=>{let s=0;const a=(e,s)=>{t.log(e,s)},i=(e,t)=>{const i=(e=>{switch(e){case"started":return 1;case"first_quartile":return 2;case"midpoint":return 3;case"third_quartile":return 4;case"ended":case"error":return 5;default:return null}})(e);i?i>s&&(s=i,a(e,t)):a(e,t)};return{onStarted(){i("viewed",e),i("started",e),l(!1)},onResumed(){l((t=>(t&&i("resumed",e),!1)))},onPaused(){l(!0),i("paused",e)},onVolumeChanged({volume:t}){const s=t<=0;r(s),i(s?"muted":"unmuted",e)},onPlaybackCreated({timeObservable:t}){t.addObserverForMediaPositions([.25,.5,.75],(t=>{t>=.25&&i("first_quartile",e),t>=.5&&i("midpoint",e),t>=.75&&i("third_quartile",e)}))},onPlaybackEnded({reason:t}){switch(t){case te.mT.FATAL_ERROR:case te.mT.NETWORK_ERROR:i("error",e);break;case te.mT.PLAYED_TO_END:i("ended",e)}},onReady(){c(!1)},onPlaybackError(){c(!1),m(!0)}}}),[e,t]),viewabilityObserverFactory:h}}(t,l,s,u),g=(0,a.useMemo)((()=>(0,ke.U5)((0,ke.sH)(t.adId))),[t.adId]),k=function({assetUrl:e,createVideoPlayer:t,playVideoPlayer:s,observerFactory:a,viewabilityObserverFactory:i,playback_id:o,playWhenReady:r,muted:n}){return(0,A.A)((async({videoContainerElement:l,"video-manifest-url":d})=>{try{return await s(t(d,l,a,i).setAudioDisabled(n),{mediaUrl:e,playback_id:o,playWhenReady:r})}catch(e){return}}))}({assetUrl:e,createVideoPlayer:i,playVideoPlayer:o,observerFactory:f,viewabilityObserverFactory:x,playback_id:g,playWhenReady:u,muted:m});return function({videoContainerElement:e,initializeBetamaxPlayer:t,setBetamaxPlayer:s}){const i=(0,Z.g)(),o=(0,a.useRef)(),r=(0,a.useRef)();(0,a.useEffect)((()=>{const a=i.getValues();o.current=a;const n=a.then((s=>{if(a===o.current){const a=s["video-manifest-url"];if(a)return t({videoContainerElement:e,"video-manifest-url":a})}}));r.current=n,s(n),n.then((e=>{n===r.current&&s(e)}))}),[t,e,s,i])}({videoContainerElement:s,initializeBetamaxPlayer:k,setBetamaxPlayer:n}),function({betamaxPlayer:e,assetUrl:t,playVideoPlayer:s,playback_id:i,playWhenReady:o}){const r=(0,A.A)((async t=>{e instanceof J.M&&await s(e,{mediaUrl:t,playback_id:i,playWhenReady:o})}));(0,a.useEffect)((()=>{r(t)}),[t,r])}({betamaxPlayer:r,assetUrl:e,playVideoPlayer:o,playback_id:g,playWhenReady:u}),((e,t,s=!1)=>{(0,a.useEffect)((()=>{e instanceof J.M&&!s&&(t?e.pause():e.setAudioDisabled(!0))}),[s,t,e])})(r,d,c),function({betamaxPlayer:e}){(0,a.useEffect)((()=>e&&e instanceof J.M?()=>{e.release()}:void 0),[e])}({betamaxPlayer:r}),y||r&&"then"in r?(0,p.jsx)(H,{className:G,icon:(0,p.jsx)(X.a3,{"aria-label":"Loading"})}):b||!r?(0,p.jsx)(Y,{homeVideoAd:t}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:Ae}),(0,p.jsx)(ve,{betamaxPlayer:r,muted:m,paused:h,isContextPlayerVideoPlaying:d,isContextPlayerPlaybackPaused:c})]})},Ce=({assetUrl:e,className:t,homeVideoAd:s})=>{const[i,o]=(0,a.useState)(null);return z((0,a.useMemo)((()=>s.metadata.logoImage||I(s)),[s])),(0,p.jsx)("div",{"data-testid":"home-ad-video-asset",className:l()(je,t),ref:o,children:i&&(0,p.jsx)(Pe,{homeVideoAd:s,assetUrl:e,videoContainerElement:i})})};var Ee=s(99904);var Ne=s(8476),we=s(65819);function _e({extractedHomeAdColor:e}){const{extractedHomeAdColor:[,t]}=(0,y.bT)();return(0,a.useEffect)((()=>t(e)),[e,t]),(0,a.useEffect)((()=>()=>t(void 0)),[t]),(0,Ne.z)(e.colorRaw),null}function Se(){const{imageUrlToExtractHomeAdColorFrom:[e]}=(0,y.bT)(),t=(0,we.r)(e);return t?(0,p.jsx)(_e,{extractedHomeAdColor:t}):null}var Re=s(1744);const Ue="gPtBODu_UjOYUZsXyVaw",Te="OMnQ68kGUatqLnLhldea",Me="qwCxwlFGiJwd7y757EIC",Ve="n2TcVzKfe8w5qBzk_mHR",Le="iBi4L8rZvqCYwumUXiyQ",Oe="BbCl59l9jseBESAVkMFS",Fe="_7BNL4Ovo2FE4OHUXD3b",He=(0,Re.H)((({homeAd:e,dismiss:t},s)=>{const i=(0,a.useMemo)((()=>{if(t=e,(0,d.pq)(t.format)===d.nM.VIDEO){const t=function(e){for(const{videoManifestId:t,url:s}of e.video){if(t){const e=Ee.DJ.create(t);if(e)return e}if(s)return s}}(e);if(t)return{homeAd:e,videoAssetUrl:t}}var t}),[e]),{setGridElement:o,shownHeight:n,transitionableStyles:l,containerRef:c,collapseHeightThenDismiss:u}=r({dismiss:t});return(0,p.jsxs)("div",{className:Ue,style:l,ref:e=>{c.current=e,"function"==typeof s?s(e):s&&(s.current=e)},"data-testid":"home-ad-card",children:[n&&(0,p.jsx)(Se,{}),(0,p.jsx)("div",{className:Te,children:(0,p.jsxs)("div",{className:Me,ref:o,children:[i?(0,p.jsx)(Ce,{className:Ve,homeVideoAd:i.homeAd,assetUrl:i.videoAssetUrl}):(0,p.jsx)(q,{className:Ve,homeAd:e}),(0,p.jsx)(V,{className:Le,homeAd:e}),(0,p.jsx)(S,{className:Oe,homeAd:e}),(0,p.jsx)(E,{className:Fe,dismiss:u,homeAd:e})]})})]})})),ze=(0,Re.H)((({homeAd:e},t)=>{const{dismissed:s,dismiss:a}=(0,y.bT)();return s?null:(0,p.jsx)(He,{homeAd:e,dismiss:a,ref:t})})),Be=ze},43602:(e,t,s)=>{s.d(t,{L:()=>i});var a=s(56989);const i=()=>{const{logger:e}=(0,a.bT)();return e}},8476:(e,t,s)=>{s.d(t,{f:()=>n,z:()=>r});var a=s(30758),i=s(50780),o=s(57286);function r(e,t=i.l0o){const s=(0,o.as)();return(0,a.useEffect)((()=>(e&&s((0,o.Mo)(e)),()=>{s((0,o.Hf)())})),[e,s]),e||t}const n=({color:e,fallbackColor:t})=>(r(e,t),null)}}]);
//# sourceMappingURL=home-ad-card.js.map