"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[1344],{34605:(e,t,i)=>{i.d(t,{x:()=>C});var r=i(30758),n=i(95440),s=i(6128),a=i(64721),c=i(97500),o=i.n(c),l=i(21743);const d="lyrics-lyricsContent-lyric",u="lyrics-lyricsContent-active",y="lyrics-lyricsContent-highlight",v="lyrics-lyricsContent-unsynced",m="lyrics-lyricsContent-isInteractive",p="lyrics-lyricsContent-text",f="Zg6tXwNaAAopLykLK7Cw",h="lyrics-lyricsContent-provider";var g=i(86070);const L=r.memo((function({onObserve:e,text:t,lineNumber:i,activeLineIndex:n,isTimeSynced:s,translationText:a,onClick:c,onActiveLineChange:h,windowIsVisible:L}){const{ref:b,inView:w}=(0,l.Wx)({threshold:0}),S=(0,r.useRef)(!1);(0,r.useEffect)((()=>{S.current||w&&L&&(e(t),S.current=!0)}),[w,e,t,L]);const k=(0,r.useRef)(),I=(0,r.useRef)(!0);(0,r.useEffect)((()=>{h(k,I.current),I.current=!1}),[n,h]);const T=(0,r.useCallback)((e=>{b(e),k.current=e||void 0}),[b]);return(0,g.jsxs)("div",{dir:"auto",className:o()(d,{[m]:!!c,[u]:n===i,[y]:n>i,[v]:!s}),"data-testid":"fullscreen-lyric",ref:T,onClick:c,children:[(0,g.jsx)("div",{className:p,children:t}),a&&(0,g.jsx)("div",{className:f,children:a})]})}));var b=i(40564);const w={start:0,end:1,text:""};var S=i(33102),k=i(84576),I=i(84014);var T=i(37145),x=i(68437);const C=r.memo((function({trackUri:e,data:t,format:i,onLineClick:c,onActiveLineChange:o,isSnippet:l}){const{provider:d,providerLyricsId:u,providerDisplayName:y,syncType:v,isTimeSynced:m}=t,p=(0,n.d4)(T.s),{lyricWithEmptyLines:f,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}=((e,t,i)=>{const n=(0,r.useRef)(0),{lyrics:s=[],isTimeSynced:a,alternatives:c}=t,o=(0,r.useRef)(0),[l]=(0,b.f)(500,(t=>t?.item?.uri===e)),d=i?c?.find((({language:e})=>e.substring(0,2)===i.substring(0,2)))?.lines:null,u=(0,r.useMemo)((()=>[...new Array(2).fill(w),...s].map(((e,t)=>({...e,lineNumber:t,translationText:d?.[t-2]})))),[s,d]),y=a?u.findIndex((({start:e,end:t})=>l>=e&&l<t)):-1,v=o.current;o.current=y;const m=Math.abs(y-v)<=4,p=Math.abs(l-n.current)>2e3;return n.current=l,{lyricWithEmptyLines:u,activeLineIndex:y,prevActiveLineIndex:v,lineIndexDiff:y-v,shouldAnimateScroll:m,hasSkipped:p}})(e,t,p),A=function(e){const{trackUri:t,format:i,provider:n,providerLyricsId:s,syncType:a,isSnippet:c}=e,[o,l]=(0,r.useState)(!1),[d,u]=(0,r.useState)(0),[y,v]=(0,r.useState)(!1),m=(0,I.o)((e=>e?.playbackId??void 0)),p=(0,r.useMemo)((()=>(0,S.W)({lyrics_format:i,track_uri:t,provider:n,provider_lyrics_id:s,sync_type:a,playback_id:m,is_snippet:c})),[i,t,n,s,a,m,c]);(0,r.useEffect)((()=>{l(!1),u(0),v(!1);const e=setTimeout((()=>{v(!0)}),1500);return()=>{clearTimeout(e)}}),[p]);const f=(0,k.vh)();return(0,r.useEffect)((()=>{o||d>=140&&y&&(f.send(p),l(!0))}),[d,o,p,f,y]),(0,r.useCallback)((e=>{e.length>1&&u((t=>t+e.length))}),[u])}({trackUri:e,format:i,provider:d,providerLyricsId:u,syncType:v,isSnippet:l}),_=(0,x.g)();return(0,g.jsxs)(g.Fragment,{children:[f.map((({text:e,lineNumber:t,translationText:i})=>(0,g.jsx)(L,{text:e,translationText:i,lineNumber:t,activeLineIndex:C,isTimeSynced:m,onObserve:A,onClick:c&&(e=>c(e,f[t].start)),onActiveLineChange:(e,i)=>o({lineRef:e,firstUpdate:i,isFirstLine:m&&0===t,isActiveLine:m&&C===t,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}),windowIsVisible:"visible"===_},t))),!l&&y&&(0,g.jsx)("div",{className:h,children:(0,g.jsx)(s.E,{as:"p",variant:"bodySmall",dir:"auto",children:a.Ru.get("web-player.lyrics.providedBy",y)})})]})}))},60114:(e,t,i)=>{i.d(t,{H:()=>n,k:()=>r});const r=18e5,n=6e5},81178:(e,t,i)=>{i.d(t,{I:()=>h});var r=i(15758),n=i(63166),s=i(60114),a=i(64422),c=i(95826),o=i(38241),l=i(34083),d=i(8296),u=i(91470);function y(e,t,i){const{startTimeMs:r,words:n}=e,s=i[t+1];return{start:r||0,end:s&&s.startTimeMs?s.startTimeMs:1/0,text:n}}function v(e){return d.Q.fromInt(e).toCSS(u.a.RGB)}var m=i(49502),p=i(27602);const f={hasLyrics:!1},h=(e,t)=>{const i=(0,m.h)(t||void 0,{desiredLabel:"large",desiredSize:600})??t?.[0]?.url??"",d=(0,c.X)(),u=(0,n.NC)(p.Tc,{loadingValue:p.LZ.CONTROL}),h={[p.LZ.CONTROL]:void 0,[p.LZ.SYSTEM_LANGUAGE]:navigator.language,[p.LZ.ALL_LANGUAGES]:"all"}[u],g=["lyrics",{uri:e,image:i,vocalRemoval:d}],{hasLyrics:L,isLoading:b}=(0,a.f)(e),{data:w,isLoading:S,isError:k}=(0,r.I)({queryKey:g,queryFn:async()=>{if(!e||!i)return f;const t=await async function(e,t,i=!1,r){try{const a=await(0,o.S)(e,t,i,r);return{hasLyrics:!0,isTimeSynced:(s=a.lyrics.syncType,"LINE_SYNCED"===s||"SYLLABLE_SYNCED"===s),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(y),colors:(n=a.colors,{text:v(n.text),activeText:v(n.highlightText),background:v(n.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1,showUpsell:a.lyrics.showUpsell??!1,alternatives:a.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var n,s}(e,i,d,h);return t},gcTime:s.k,staleTime:s.H,enabled:L}),I=b||S;let T=null;return I||(T=L?w??null:f),{data:T,loading:I,error:k}}},64422:(e,t,i)=>{i.d(t,{f:()=>d});var r=i(15758),n=i(72509),s=i(63166),a=i(75627),c=i(60114),o=i(38241),l=i(19412);const d=e=>{const t=!!e&&(0,a.U_m)(e),i=(0,s.NC)(l.s6w)&&t,{data:d,isLoading:u}=(0,r.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,o.z)(e),gcTime:c.k,staleTime:c.H,enabled:i,placeholderData:n.rX});return{isLoading:u,hasLyrics:!!i&&(d??!1)}}},29754:(e,t,i)=>{i.d(t,{J:()=>s});var r=i(81178),n=i(84014);const s=()=>{const e=(0,n.o)((e=>e?.item),((e,t)=>e?.uri===t?.uri));return(0,r.I)(e?.uri,e?.images)}},95826:(e,t,i)=>{i.d(t,{X:()=>a});var r=i(63166),n=i(19412),s=i(63560);const a=()=>{const e=(0,s.S)(),{isSupported:t}=e.getCapabilities();return(0,r.NC)(n.OBX,{loadingValue:!1})&&t}},37145:(e,t,i)=>{i.d(t,{s:()=>n,u:()=>r});const r=e=>e.ui.lyrics.mode,n=e=>e.ui.lyrics.translationLanguage},38241:(e,t,i)=>{i.d(t,{S:()=>a,z:()=>c});var r=i(75627),n=i(5050),s=i(96022);const a=async(e,t,i,a)=>{const c=(0,r.o_h)(e).id,o=n.n.getInstance(),l={format:"json",vocalRemoval:i};a&&(l.clientLanguage=a);return(await o.build().withHost(s.Hj).withPath(`/track/${encodeURIComponent(c)}/image/${encodeURIComponent(t)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},c=async e=>{const t=(0,r.Y8v)((0,r.o_h)(e)?.id);if(!t)return!1;const i=n.n.getInstance(),a=await i.build().withHost(s.XE).withPath(`/track/${encodeURIComponent(t)}`).withEndpointIdentifier("/track/{trackId}").send();return a.body?.has_lyrics||!1}},68437:(e,t,i)=>{i.d(t,{g:()=>n});var r=i(30758);function n(){const[e,t]=(0,r.useState)(document.visibilityState);return(0,r.useEffect)((()=>{const e=()=>t(document.visibilityState);return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}),[]),e}},8476:(e,t,i)=>{i.d(t,{f:()=>c,z:()=>a});var r=i(30758),n=i(50780),s=i(57286);function a(e,t=n.l0o){const i=(0,s.as)();return(0,r.useEffect)((()=>(e&&i((0,s.Mo)(e)),()=>{i((0,s.Hf)())})),[e,i]),e||t}const c=({color:e,fallbackColor:t})=>(a(e,t),null)},18426:(e,t,i)=>{i.d(t,{H:()=>p});var r=i(63166),n=i(15758),s=i(12978),a=i(99612),c=i(85653),o=i(48125),l=i(4490),d=i(27602),u=i(85690),y=i(30758);var v=i(84014),m=i(49502);function p(){const e=(0,v.o)((e=>e?.item),((e,t)=>e?.uri===t?.uri)),t=(0,m.h)(e?.images||void 0,{desiredLabel:"large",desiredSize:600})??e?.images?.[0]?.url??"",{data:i}=function(e){const t=(0,r.NC)(d.HO),{request:i}=(0,y.useContext)(o.j);return(0,n.I)({enabled:t&&e.length>0&&e.every((e=>!!e)),queryKey:["useFetchDynamicColorsByUris",...e],gcTime:864e5,staleTime:432e5,queryFn:async()=>{const t=await(0,l.c)(i,a.DO,{imageUris:e}),r=t?.data,n=r?.dynamicColors.at(0);if(!n)throw new s.t("Empty response");switch(n.__typename){case"GenericError":throw new s.t(`Invalid response ${t}`);case"DynamicColors":break;default:(0,u.d)(n)}return(0,c.V)(n.dark)},select:e=>t?e:null})}([t]);return i??null}}}]);
//# sourceMappingURL=1344.js.map